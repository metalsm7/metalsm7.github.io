"use strict";var Hacci=function(){function Hacci(e){if(void 0===e&&(e=null),this._id=null,this._el=null,this._refs={},this._on={created:null,mounted:null,destroyed:null},this._event_listeners=[],this._id=this.createInstanceId(),Hacci.instances[this._id]=this,(e=e||{el:null,template:null,data:null,method:null,created:null,mounted:null,destroyed:null}).el&&(this._el=e.el),e.template&&(this._template=e.template),e.data)for(var t=Object.keys(e.data),n=0;n<t.length;n++)this[t[n]]=e.data[t[n]];if(e.method)for(var i=Object.keys(e.method),n=0;n<i.length;n++)this[i[n]]=this.fromArrowFunc(e.method[i[n]]).bind(this);e.created&&(this._on.created=this.fromArrowFunc(e.created).bind(this)),e.mounted&&(this._on.mounted=this.fromArrowFunc(e.mounted).bind(this)),e.destroyed&&(this._on.destroyed=this.fromArrowFunc(e.destroyed).bind(this)),this._template&&(this.el.innerHTML=this._template),this._on&&this._on.created&&this._on.created()}return Object.defineProperty(Hacci,"instances",{get:function(){return Hacci._instances},enumerable:!0,configurable:!0}),Hacci.prototype.init=function(){var s=this;if(this.el){new MutationObserver(function(e,t){for(var n=0,i=e;n<i.length;n++){var r=i[n];"childList"!==r.type||(r=r.removedNodes)&&0<r.length&&r[0]===s.el&&(t.disconnect(),s.clearEventListeners(),s.destroy())}}).observe(this.el.parentElement,{attributes:!1,childList:!0,subtree:!1});for(var i=this.el.querySelectorAll("*"),a=this,e=0;e<i.length;e++)!function(e){for(var r=i[e],t=r.attributes,n=0;n<t.length;n++)if(/^hc:/.test(t[n].name))switch(t[n].name){case"hc:ref":a._refs[t[n].value]=r;break;case"hc:click":a.registEventListener(r,"click",t[n]);break;case"hc:input":-1<["INPUT","SELECT"].indexOf(r.tagName)&&-1<["radio","checkbox","select-one","select-multiple"].indexOf(r.type)&&a.registEventListener(r,"change",t[n]),-1<["INPUT","TEXTAREA"].indexOf(r.tagName)&&-1<["text","textarea"].indexOf(r.type)&&a.registEventListener(r,"input",t[n]),-1<["INPUT","TEXTAREA","SELECT"].indexOf(r.tagName)&&-1<["text","textarea","select-one","select-multiple"].indexOf(r.type)&&a.observeElement(r,"value",function(e,t){var n=-1<["select-one","select-multiple"].indexOf(r.type)?"change":"input",i=null;"function"==typeof Event?i=new Event(n):(i=document.createEvent("Event")).initEvent(n,!0,!0),r.dispatchEvent(i)}),-1<["INPUT"].indexOf(r.tagName)&&-1<["radio","checkbox"].indexOf(r.type)&&a.observeElement(r,"checked",function(e,t){var n=null;"function"==typeof Event?n=new Event("change"):(n=document.createEvent("Event")).initEvent("change",!0,!0),r.dispatchEvent(n)});break;case"hc:value":r.value=a[t[n].value];break;case"hc:checked":case"hc:selected":(-1<["true","false"].indexOf(t[n].value)?"true"===t[n].value:a[t[n].value])?r.setAttribute(t[n].name.substring(3),null):r.removeAttribute(t[n].name.substring(3));break;case"hc:text":r.innerText=a[t[n].value];break;case"hc:html":r.innerHTML=a[t[n].value]}}(e)}this._on&&this._on.mounted&&this._on.mounted()},Hacci.prototype.refresh=function(){this.clearEventListeners(),this.init()},Hacci.prototype.clearEventListeners=function(){for(var e=0;e<this._event_listeners.length;e++){var t=this._event_listeners[e];t.el.removeEventListener(t.name,t.listener)}this._event_listeners=[]},Hacci.prototype.registEventListener=function(e,t,n){function i(e){r.callMethod({attr:n,evt:e})}var r=this;e.addEventListener(t,i),this._event_listeners.push({el:e,name:t,listener:i})},Hacci.prototype.callMethod=function(option){var has_bracket=-1<option.attr.value.indexOf("("),method_name=has_bracket?option.attr.value.replace(/\(.*/,""):option.attr.value,args_1;has_bracket?(args_1=option.attr.value.replace(/^\w*\(/,"").replace(/\)$/,"").split(","),args_1.forEach(function(el,idx){var new_el=el.replace(/^\s*/,"").replace(/\s*$/,"");args_1[idx]="_event"===new_el?option.evt:eval(new_el)}),args_1.length<2&&""===args_1[0]&&(args_1[0]=option.evt),this[method_name].apply(this,args_1)):this[method_name](option.evt)},Hacci.prototype.observeElement=function(e,n,i){var r,t=Object.getPrototypeOf(e);t.hasOwnProperty(n)&&(r=Object.getOwnPropertyDescriptor(t,n),Object.defineProperty(e,n,{get:function(){return r.get.apply(this,arguments)},set:function(){var e=this[n];r.set.apply(this,arguments);var t=this[n];return i&&setTimeout(i.bind(this,e,t),0),t}}))},Hacci.prototype.createInstanceId=function(){for(var e="",t=0;t<8;t++){var n=Math.floor(51*Math.random());e+=String.fromCharCode(n+(n<26?65:71))}return e+="."+Date.now()},Hacci.prototype.isArrowFunc=function(e){return void 0===e.prototype},Hacci.prototype.fromArrowFunc=function(e){if(this.isArrowFunc(e)){var t="return function"+("("===(t=e.toString()).substring(0,1)?"":"(")+t.replace(/\)?\s*=>.*{(.|\r|\n)*/,")")+t.replace(/^.*=>\s*{/,"{");return new Function(t)()}return e},Hacci.prototype.destroy=function(){this.clearEventListeners(),this._refs={},this._template&&this.el.parentElement.removeChild(this.el),this._template=null,this._el=null,this._on&&this._on.destroyed&&this._on.destroyed(),this._on={created:null,mounted:null,destroyed:null},Hacci.instances[this._id]&&(Hacci.instances[this._id]=null,delete Hacci.instances[this._id])},Hacci.prototype.mount=function(e){return e&&(this._el=e),this.init(),this},Object.defineProperty(Hacci.prototype,"el",{get:function(){return this._el},enumerable:!0,configurable:!0}),Object.defineProperty(Hacci.prototype,"refs",{get:function(){return this._refs},enumerable:!0,configurable:!0}),Hacci._instances={},Hacci}();window.Hacci=Hacci;
