"use strict";var Hacci=function(){function Hacci(e){if(void 0===e&&(e=null),this._id=null,this._el=null,this._refs={},this._traces={model:{}},this._objs={},this._txts=[],this._txts_mstr=null,this._on={created:null,mounted:null,destroyed:null},this._event_listeners=[],this._toi_input=["email","hidden","number","password","search","tel","url","datetime","text","textarea"],this._toi_check=["radio","checkbox"],this._toi_select=["select-one","select-multiple"],this._bus={},(e=e||{id:null,el:null,template:null,data:null,method:null,created:null,mounted:null,destroyed:null}).id||(e.id=this.createInstanceId()),!new RegExp(/^[a-zA-Z_][0-9a-zA-Z_-]+$/).test(e.id))throw new Error("id format is invalid");if(this._id=e.id,Hacci.instances[this._id]=this,e.el&&(this._el=e.el),e.template&&(this._template=e.template),e.data)for(var t=Object.keys(e.data),r=0;r<t.length;r++)this[t[r]]=e.data[t[r]],this.traceModel({parent:this,property:t[r],value:null});if(e.method)for(var n=Object.keys(e.method),r=0;r<n.length;r++)this[n[r]]=this.fromArrowFunc(e.method[n[r]]).bind(this);e.created&&(this._on.created=this.fromArrowFunc(e.created).bind(this)),e.mounted&&(this._on.mounted=this.fromArrowFunc(e.mounted).bind(this)),e.destroyed&&(this._on.destroyed=this.fromArrowFunc(e.destroyed).bind(this)),this._template&&(this.el.innerHTML=this._template),this._on&&this._on.created&&this._on.created()}return Object.defineProperty(Hacci,"instances",{get:function(){return Hacci._instances},enumerable:!0,configurable:!0}),Hacci.prototype.init=function(){var s=this,c=this;if(this.el){new MutationObserver(function(e,t){for(var r=0,n=e;r<n.length;r++){var a=n[r];"childList"!==a.type||(a=a.removedNodes)&&0<a.length&&a[0]===s.el&&(t.disconnect(),s.clearEventListeners(),s.destroy())}}).observe(this.el.parentElement,{attributes:!1,childList:!0,subtree:!1}),this.searchTextNodes();for(var a=this.el.querySelectorAll("*"),e=function(e){for(var l=a[e],o=l.attributes,t=0;t<o.length;t++)!function(a){if(/^hc:(model|if|neither|disabled|html|text)$/.test(o[a].name)){if(h.traceModel({parent:h,property:o[a].value,value:null}),/^hc:(if|neither)$/.test(o[a].name)){var e,t=h.getVal(o[a].value,h);(/^hc:if$/.test(o[a].name)&&!1===t.val||/^hc:neither$/.test(o[a].name)&&!0===t.val)&&(r=c.createTagId(),e=window.document.createComment("//hc:"+c._id+":"+r),l.parentNode.insertBefore(e,l),c._objs[o[a].value]||(c._objs[o[a].value]=[]),c._objs[o[a].value].push({type:"if",tag_id:r,parent:l.parentElement,element:l}),l.parentNode.removeChild(l))}else if(/^hc:disabled$/.test(o[a].name)){t=h.getVal(o[a].value,h);l.disabled=t.val}else if(/^hc:html$/.test(o[a].name)){t=h.getVal(o[a].value,h);l.innerHTML=t.val}else if(/^hc:text$/.test(o[a].name)){t=h.getVal(o[a].value,h);l.innerText=t.val}else if(!/^hc:model$/.test(o[a].name))return;var i,r,n;"INPUT"===l.tagName&&-1<c._toi_check.indexOf(l.type)?(i=h.getVal(o[a].value,h),(r=l.hasAttribute("name")?l.getAttribute("name"):null)?(n=c.el.querySelectorAll("*[name="+r+"]"),c.setCheckedValue(n,i.val)):l.checked=l.value==i.val,l.addEventListener("change",function(e){var t=null;"radio"===l.type&&(t=l.checked?l.value:null),"checkbox"===l.type&&(t=l.checked?l.value:l.hasAttribute("name")?[]:null);var r=l.hasAttribute("name")?l.getAttribute("name"):null;r?(n=c.el.querySelectorAll("*[name="+r+"]"),t=c.getCheckedValue(n,"checkbox"===l.type)):l.checked=l.value==i.val,Array.isArray(t)&&c.arrayEventListener(o[a].value,t);var n=c.getVal(o[a].value,c._traces.model,"__");n.parent[n.prop]=t,s.modelTrigger(l)})):"SELECT"===l.tagName&&-1<c._toi_select.indexOf(l.type)?(t=h.getVal(o[a].value,h),n=l.querySelectorAll("option"),c.setSelectedValue(n,t.val),l.addEventListener("change",function(e){l.type;var t=l.querySelectorAll("option"),r=c.getSelectedValue(t,"select-multiple"===l.type);Array.isArray(r)&&c.arrayEventListener(o[a].value,r);t=c.getVal(o[a].value,c._traces.model,"__");t.parent[t.prop]=r,s.modelTrigger(l)})):-1<["INPUT","TEXTAREA"].indexOf(l.tagName)&&-1<c._toi_input.indexOf(l.type)&&(t=h.getVal(o[a].value,h),l.value=t.val,l.addEventListener("input",function(e){var t=l.value,r=c.getVal(o[a].value,c._traces.model,"__");r.parent[r.prop]=t,s.modelTrigger(l)}))}}(t)},h=this,t=0;t<a.length;t++)e(t);for(var r=function(e){for(var r=a[e],n=r.attributes,t=0;t<n.length;t++)!function(t){if(/^hc:(ref|click|scroll(\.hit\.(top|bottom))?)$/.test(n[t].name))switch(n[t].name){case"hc:ref":i._refs[n[t].value]=r;break;case"hc:click":case"hc:scroll":i.registEventListener(r,n[t].name.substring(3),n[t]);break;case"hc:scroll.hit.top":case"hc:scroll.hit.bottom":i.registEventListener(r,"scroll",n[t],function(e){(-1<n[t].name.indexOf("bottom")?c.scrollTop(r)+c.innerHeight(r)>=c.scrollHeight(r):c.scrollTop(r)<=0)&&c.callMethod({attr:n[t],evt:e})})}}(t)},i=this,t=0;t<a.length;t++)r(t)}this._on&&this._on.mounted&&this._on.mounted()},Hacci.prototype.refresh=function(){this.clearData(),this.clearEventListeners(),this.init()},Hacci.prototype.clearData=function(){for(var e=new RegExp(/^__hc\.(v_.+|lstn$|refs$)/),t=Object.keys(this),r=0;r<t.length;r++)e.test(t[r])&&delete this[t[r]]},Hacci.prototype.searchTextNodes=function(e){if((e=(e=void 0===e?null:e)||this.el).hasChildNodes()){for(var t=0;t<e.childNodes.length;t++)switch(e.childNodes[t].nodeType){case 1:this.searchTextNodes(e.childNodes[t]);break;case 3:/{{([^}}\r\n]+)?}}/g.test(e.childNodes[t].textContent)&&this._txts.push({node:e.childNodes[t],text:e.childNodes[t].textContent,fn:null})}this.applyTextChange()}},Hacci.prototype.applyTextChange=function(){for(var e=0;e<this._txts.length;e++)this._txts[e].fn||(this._txts[e].fn=this.compileText(this._txts[e].text)),this._txts[e].node.textContent=this._txts[e].fn.apply(this)},Hacci.prototype.compileText=function(e){if(!this._txts_mstr){this._txts_mstr="";for(var t=Object.keys(this),r=0;r<t.length;r++)1<t[r].length&&"_"===t[r].charAt(0)||(this._txts_mstr+="var "+t[r]+"=this."+t[r]+";\n")}for(var n,a=/{{([^}}]+)?}}/g,i=/(^( )?(if|for|else|switch|case|break|{|}))(.*)?/g,l=this._txts_mstr+"var r=[];\n",o=0,s=function(e,t){return l+=(t=void 0===t?null:t)?e.match(i)?e+"\n":"r.push("+e+");\n":""!=e?'r.push("'+e.replace(/"/g,'\\"')+'");\n':"",s};n=a.exec(e);)s(e.slice(o,n.index))(n[1],!0),o=n.index+n[0].length;return s(e.substr(o,e.length-o)),l+='return r.join("");',new Function(l.replace(/[\r\t\n]/g,""))},Hacci.prototype.registEventListener=function(e,t,r,n){var a=this;e.addEventListener(t,n=(n=void 0===n?null:n)||function(e){a.callMethod({attr:r,evt:e})}),this._event_listeners.push({el:e,name:t,listener:n})},Hacci.prototype.clearEventListeners=function(){for(var e=0;e<this._event_listeners.length;e++){var t=this._event_listeners[e];t.el.removeEventListener(t.name,t.listener)}this._event_listeners=[]},Hacci.prototype.modelTrigger=function(e){for(var t=null,r=e.attributes,n=0;n<r.length;n++)if(/^hc:model$/.test(r[n].name)){t=r[n];break}if(t){for(var a=this.getVal(t.value,this),i=[],l=this.el.querySelectorAll("*"),n=0;n<l.length;n++){for(var o=l[n],r=o.attributes,s={change:{proc:!1,attr:null},input:{proc:!1,attr:null}},c=0;c<r.length;c++)if(/^hc:change$/.test(r[c].name)){s.change.proc=!0,s.change.attr=r[c].value;break}for(var h=0;h<r.length;h++)if(/^hc:input$/.test(r[h].name)){s.input.proc=!0,s.input.attr=r[h].value;break}for(var u=0;u<r.length;u++)if(/^hc:model$/.test(r[u].name)&&r[u].value===t.value)if("INPUT"===o.tagName&&-1<this._toi_check.indexOf(o.type)){Array.isArray(a.val)?o.checked=-1<a.val.indexOf(o.value):o.checked=a.val==o.value;var p=o.hasAttribute("name")?o.getAttribute("name"):null,d=-1<i.indexOf(p);d&&(s.change.proc=!1),d||i.push(p),s.change.proc&&this.callMethod({attr:{value:s.change.attr},evt:null})}else if("SELECT"===o.tagName&&-1<this._toi_select.indexOf(o.type)){for(var v=o.querySelectorAll("option"),f=0;f<v.length;f++)Array.isArray(a.val)?v[f].selected=-1<a.val.indexOf(v[f].value):v[f].selected=a.val==v[f].value;s.change.proc&&this.callMethod({attr:{value:s.change.attr},evt:null})}else-1<["INPUT","TEXTAREA"].indexOf(o.tagName)&&-1<this._toi_input.indexOf(o.type)&&(o.value=a.val,s.input.proc&&this.callMethod({attr:{value:s.input.attr},evt:null}));else/^hc:disabled$/.test(r[u].name)&&r[u].value===t.value?o.disabled=a.val:/^hc:(html|text)$/.test(r[u].name)&&r[u].value===t.value&&("hc:html"===r[u].name?o.innerHTML=a.val:o.innerText=a.val)}this.applyTextChange()}},Hacci.prototype.callMethod=function(option){var has_bracket=-1<option.attr.value.indexOf("("),method_name=has_bracket?option.attr.value.replace(/\(.*/,""):option.attr.value,args_1;has_bracket?(args_1=option.attr.value.replace(/^\w*\(/,"").replace(/\)$/,"").split(/,(?=(?:(?:[^']*'){2})*[^']*$)/),args_1.forEach(function(el,idx){var new_el=el.replace(/^\s*/,"").replace(/\s*$/,"");args_1[idx]="_event"===new_el?option.evt:eval(new_el)}),this[method_name].apply(this,args_1)):this[method_name](option.evt)},Hacci.prototype.getRandomString=function(e){for(var t="",r=0;r<e;r++){var n=Math.floor(51*Math.random());t+=String.fromCharCode(n+(n<26?65:71))}return t},Hacci.prototype.createInstanceId=function(){return this.getRandomString(8)+"_"+Date.now()},Hacci.prototype.createTagId=function(){return this.getRandomString(6)+"_"+Date.now()},Hacci.prototype.getCommentElement=function(e,t){for(var r=null,n=0;n<e.childNodes.length;n++){var a=e.childNodes[n];if(a.nodeType===Node.COMMENT_NODE&&a.textContent=="//hc:"+this._id+":"+t){r=a;break}}return r},Hacci.prototype.isArrowFunc=function(e){return void 0===e.prototype},Hacci.prototype.fromArrowFunc=function(e){if(this.isArrowFunc(e)){var t="return function"+("("===(t=e.toString()).substring(0,1)?"":"(")+t.replace(/\)?\s*=>.*{(.|\r|\n)*/,")")+t.replace(/^.*=>\s*{/,"{");return new Function(t)()}return e},Hacci.prototype.getCheckedValue=function(e,t){for(var r=(t=void 0===t?!1:t)?[]:null,n=0;n<e.length;n++){var a=e[n];if(a.checked&&!t){r=a.value;break}a.checked&&t&&r.push(a.value)}return r},Hacci.prototype.getSelectedValue=function(e,t){for(var r=(t=void 0===t?!1:t)?[]:null,n=0;n<e.length;n++){var a=e[n];if(a.selected&&!t){r=a.value;break}a.selected&&t&&r.push(a.value)}return r},Hacci.prototype.setCheckedValue=function(e,t){for(var r=!1,n=!1,a=0;a<e.length;a++){var i=e[a];if(!n&&i.checked&&(n=!0),r=!r&&(i.checked&&(Array.isArray(t)?t.indexOf(i.value)<0:t!=i.value)||!i.checked&&(Array.isArray(t)?-1<t.indexOf(i.value):t==i.value))?!0:r)break}n||r||(r=!0);for(a=0;a<e.length;a++)(i=e[a]).checked=Array.isArray(t)?-1<t.indexOf(i.value):t==i.value;return r},Hacci.prototype.setSelectedValue=function(e,t){for(var r=!1,n=!1,a=0;a<e.length;a++){var i=e[a];if(!n&&i.selected&&(n=!0),r=!r&&(i.selected&&(Array.isArray(t)?t.indexOf(i.value)<0:t!=i.value)||!i.selected&&(Array.isArray(t)?-1<t.indexOf(i.value):t==i.value))?!0:r)break}n||r||(r=!0);for(a=0;a<e.length;a++)(i=e[a]).selected=Array.isArray(t)?-1<t.indexOf(i.value):t==i.value;return r},Hacci.prototype.getVal=function(val,init_parent,prefix){if(void 0===prefix&&(prefix=""),new RegExp(/^(true|false|'.+'|\d+)$/).test(val))return{parent:null,prop:null,val:eval(val)};for(var rtn_val={parent:null,prop:null,val:init_parent},strs=val.split("."),cnti=0;cnti<strs.length;cnti++)0!==cnti?(rtn_val.parent=rtn_val.val,rtn_val.prop=prefix+strs[cnti],rtn_val.val=rtn_val.val[prefix+strs[cnti]]):(rtn_val.parent=rtn_val.val,rtn_val.prop=prefix+strs[0],rtn_val.val=rtn_val.val[prefix+strs[0]]);return rtn_val},Hacci.prototype.setVal=function(e,t,r){for(var n=r,a=e.split("."),i=0;i<a.length;i++)void 0===n["__"+a[i]]&&(n["__"+a[i]]={}),i>=a.length-1?n["__"+a[i]]=t:n=n["__"+a[i]]},Hacci.prototype.arrayEventListener=function(n,a){var i=this._traces.model;a.push=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=(r=Array.prototype.push).call.apply(r,[a].concat(e));return i.__listen(n,a),r},a.pop=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=(r=Array.prototype.pop).call.apply(r,[a].concat(e));return i.__listen(n,a),r},a.splice=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=(r=Array.prototype.splice).call.apply(r,[a].concat(e));return i.__listen(n,a),r},a.shift=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=(r=Array.prototype.shift).call.apply(r,[a].concat(e));return i.__listen(n,a),r},a.unshift=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=(r=Array.prototype.unshift).call.apply(r,[a].concat(e));return i.__listen(n,a),r}},Hacci.prototype.traceModel=function(t){var f,r,n,a;new RegExp(/^(true|false|'.+'|\d+)$/).test(t.property)||(f=this,-1<["undefined","null"].indexOf(typeof t.parent)&&(t.parent=this),this._traces.model.__listen||(this._traces.model.__listen=function(e,t){if(f._objs[e]&&Array.isArray(f._objs[e]))for(var r=0;r<f._objs[e].length;r++){var n=f._objs[e][r];if("if"===n.type){var a=f.getCommentElement(n.parent,n.tag_id);if(a&&(a.parentNode.insertBefore(n.element,a),a.parentNode.removeChild(a),f._objs[e].splice(r,1),r--,f._objs[e].length<1)){delete f._objs[e];break}}}for(var i=[],l=f.el.querySelectorAll("*"),r=0;r<l.length;r++){for(var o=l[r],s=o.attributes,c={change:{proc:!1,attr:null},input:{proc:!1,attr:null}},h=0;h<s.length;h++)if(/^hc:change$/.test(s[h].name)){c.change.proc=!0,c.change.attr=s[h].value;break}for(h=0;h<s.length;h++)if(/^hc:input$/.test(s[h].name)){c.input.proc=!0,c.input.attr=s[h].value;break}for(var u,p,d,v,h=0;h<s.length;h++)/^hc:(if|neither)$/.test(s[h].name)&&s[h].value===e?(/^hc:if$/.test(s[h].name)&&!1===t||/^hc:neither$/.test(s[h].name)&&!0===t)&&(p=f.createTagId(),u=window.document.createComment("//hc:"+f._id+":"+p),o.parentNode.insertBefore(u,o),f._objs[e]||(f._objs[e]=[]),f._objs[e].push({type:"if",tag_id:p,parent:o.parentElement,element:o}),o.parentNode.removeChild(o)):/^hc:disabled$/.test(s[h].name)&&s[h].value===e?o.disabled=f.getVal(e,f).val:/^hc:html$/.test(s[h].name)&&s[h].value===e?o.innerHTML=f.getVal(e,f).val:/^hc:text$/.test(s[h].name)&&s[h].value===e?o.innerText=f.getVal(e,f).val:/^hc:model$/.test(s[h].name)&&s[h].value===e&&("INPUT"===o.tagName&&-1<f._toi_check.indexOf(o.type)?((u=o.hasAttribute("name")?o.getAttribute("name"):null)?(d=f.el.querySelectorAll("*[name="+u+"]"),v=f.setCheckedValue(d,t),c.change.proc=c.change.proc&&v,(p=-1<i.indexOf(u))&&(c.change.proc=!1),p||i.push(u)):o.checked=o.value==t,c.change.proc&&f.callMethod({attr:{value:c.change.attr},evt:null})):"SELECT"===o.tagName&&-1<f._toi_select.indexOf(o.type)?(d=o.querySelectorAll("option"),v=f.setSelectedValue(d,t),c.change.proc=c.change.proc&&v,c.change.proc&&f.callMethod({attr:{value:c.change.attr},evt:null})):-1<["INPUT","TEXTAREA"].indexOf(o.tagName)&&-1<f._toi_input.indexOf(o.type)&&(v=o.value!=t,c.input.proc=c.input.proc&&v,o.value=t,c.input.proc&&f.callMethod({attr:{value:c.input.attr},evt:null})))}}),r=this._traces.model,n=this.getVal(t.property,this),this.setVal(t.property,n.val,r),a=this.getVal(t.property,r,"__"),Array.isArray(n.parent[n.prop])&&this.arrayEventListener(t.property,n.parent[n.prop]),n.parent&&n.prop&&Object.defineProperty(n.parent,n.prop,{get:function(){return f.getVal(t.property,r,"__").val},set:function(e){a.parent["__"+n.prop]=e,Array.isArray(e)&&f.arrayEventListener(t.property,e),r.__listen(t.property,e),f.applyTextChange()}}))},Hacci.prototype.scrollHeight=function(e){return 9===e.nodeType?Number(window.document.documentElement.scrollHeight):Number(e.scrollHeight)},Hacci.prototype.scrollTop=function(e){e=9===e.nodeType?window.pageYOffset:e.scrollTop;return Math.ceil(e)},Hacci.prototype.innerHeight=function(e){e=9===e.nodeType?Number(Math.max(e.body.scrollHeight,e.documentElement.scrollHeight,e.body.offsetHeight,e.documentElement.offsetHeight,e.documentElement.clientHeight)):Number(e.clientHeight);return Math.ceil(e)},Hacci.prototype.on=function(e,t){this._bus[e]||(this._bus[e]=[]),-1<this._bus[e].indexOf(t)||this._bus[e].push(t)},Hacci.prototype.off=function(e,t){void 0===t&&(t=null),this._bus[e]&&!t?delete this._bus[e]:this._bus[e]&&t&&(-1<(t=this._bus[e].indexOf(t))&&this._bus[e].splice(t,1))},Hacci.prototype.emit=function(e){for(var t,r=[],n=1;n<arguments.length;n++)r[n-1]=arguments[n];if(!this._bus[e])return 0;for(var a=0,i=0;i<this._bus[e].length;i++)try{(t=this._bus[e])[i].apply(t,r),a++}catch(e){}return a},Hacci.prototype.destroy=function(){this.clearEventListeners(),this._refs={},this._template&&this.el.parentElement.removeChild(this.el),this._template=null,this._el=null,this._on&&this._on.destroyed&&this._on.destroyed(),this._on={created:null,mounted:null,destroyed:null},Hacci.instances[this._id]&&(Hacci.instances[this._id]=null,delete Hacci.instances[this._id])},Hacci.prototype.mount=function(e){return e&&(this._el=e),this.init(),this},Object.defineProperty(Hacci.prototype,"el",{get:function(){return this._el},enumerable:!0,configurable:!0}),Object.defineProperty(Hacci.prototype,"refs",{get:function(){return this._refs},enumerable:!0,configurable:!0}),Hacci._instances={},Hacci}();window.Hacci=Hacci;
