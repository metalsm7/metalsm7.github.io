"use strict";var Hacci=function(){function Hacci(e){if(void 0===e&&(e=null),this._id=null,this._el=null,this._refs={},this._traces={model:{}},this._objs={},this._on={created:null,mounted:null,destroyed:null},this._event_listeners=[],this._toi_input=["email","hidden","number","password","search","tel","url","datetime","text","textarea"],this._toi_check=["radio","checkbox"],this._toi_select=["select-one","select-multiple"],this.arrayEventListener=function(a,n){var l=this._traces.model;n.push=function(){for(var e,t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];(e=Array.prototype.push).call.apply(e,[n].concat(t)),l.__listen(a,n)},n.pop=function(){for(var e,t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];(e=Array.prototype.pop).call.apply(e,[n].concat(t)),l.__listen(a,n)},n.splice=function(){for(var e,t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];(e=Array.prototype.splice).call.apply(e,[n].concat(t)),l.__listen(a,n)},n.shift=function(){for(var e,t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];(e=Array.prototype.shift).call.apply(e,[n].concat(t)),l.__listen(a,n)},n.unshift=function(){for(var e,t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];(e=Array.prototype.unshift).call.apply(e,[n].concat(t)),l.__listen(a,n)}},(e=e||{id:null,el:null,template:null,data:null,method:null,created:null,mounted:null,destroyed:null}).id||(e.id=this.createInstanceId()),!new RegExp(/^[a-zA-Z_][0-9a-zA-Z_-]+$/).test(e.id))throw new Error("id format is invalid");if(this._id=e.id,Hacci.instances[this._id]=this,e.el&&(this._el=e.el),e.template&&(this._template=e.template),e.data)for(var t=Object.keys(e.data),r=0;r<t.length;r++)this[t[r]]=e.data[t[r]];if(e.method)for(var a=Object.keys(e.method),r=0;r<a.length;r++)this[a[r]]=this.fromArrowFunc(e.method[a[r]]).bind(this);e.created&&(this._on.created=this.fromArrowFunc(e.created).bind(this)),e.mounted&&(this._on.mounted=this.fromArrowFunc(e.mounted).bind(this)),e.destroyed&&(this._on.destroyed=this.fromArrowFunc(e.destroyed).bind(this)),this._template&&(this.el.innerHTML=this._template),this._on&&this._on.created&&this._on.created()}return Object.defineProperty(Hacci,"instances",{get:function(){return Hacci._instances},enumerable:!0,configurable:!0}),Hacci.prototype.init=function(){var s=this,u=this;if(this.el){new MutationObserver(function(e,t){for(var r=0,a=e;r<a.length;r++){var n=a[r];"childList"!==n.type||(n=n.removedNodes)&&0<n.length&&n[0]===s.el&&(t.disconnect(),s.clearEventListeners(),s.destroy())}}).observe(this.el.parentElement,{attributes:!1,childList:!0,subtree:!1});for(var r=this.el.querySelectorAll("*"),e=function(e){for(var o=r[e],c=o.attributes,t=0;t<c.length;t++)!function(n){if(/^hc:(model|if|neither|html|text)$/.test(c[n].name)){if(h.traceModel({parent:h,property:c[n].value,value:null}),/^hc:(if|neither)$/.test(c[n].name)){var e,t=h.getVal(c[n].value,h);(/^hc:if$/.test(c[n].name)&&!1===t.val||/^hc:neither$/.test(c[n].name)&&!0===t.val)&&(r=u.createTagId(),e=window.document.createComment("//hc:"+u._id+":"+r),o.parentNode.insertBefore(e,o),u._objs[c[n].value]||(u._objs[c[n].value]=[]),u._objs[c[n].value].push({type:"if",tag_id:r,parent:o.parentElement,element:o}),o.parentNode.removeChild(o))}else if(/^hc:html$/.test(c[n].name)){t=h.getVal(c[n].value,h);o.innerHTML=t.val}else if(/^hc:text$/.test(c[n].name)){t=h.getVal(c[n].value,h);o.innerText=t.val}else if(!/^hc:model$/.test(c[n].name))return;var l,r,a,i;"INPUT"===o.tagName&&-1<u._toi_check.indexOf(o.type)?(l=h.getVal(c[n].value,h),(r=o.hasAttribute("name")?o.getAttribute("name"):null)?(i=u.el.querySelectorAll("*[name="+r+"]"),u.setCheckedValue(i,l.val)):o.checked=o.value==l.val,o.addEventListener("change",function(e){var t=null;"radio"===o.type&&(t=o.checked?o.value:null),"checkbox"===o.type&&(t=o.checked?o.value:o.hasAttribute("name")?[]:null);var r=o.hasAttribute("name")?o.getAttribute("name"):null;r?(a=u.el.querySelectorAll("*[name="+r+"]"),t=u.getCheckedValue(a,"checkbox"===o.type)):o.checked=o.value==l.val,Array.isArray(t)&&u.arrayEventListener(l.prop,t);var a=u.getVal(c[n].value,u._traces.model,"__");a.parent[a.prop]=t,s.modelTrigger(o)})):"SELECT"===o.tagName&&-1<u._toi_select.indexOf(o.type)?(a=h.getVal(c[n].value,h),i=o.querySelectorAll("option"),u.setSelectedValue(i,a.val),o.addEventListener("change",function(e){o.type;var t=o.querySelectorAll("option"),r=u.getSelectedValue(t,"select-multiple"===o.type);Array.isArray(r)&&u.arrayEventListener(a.prop,r);t=u.getVal(c[n].value,u._traces.model,"__");t.parent[t.prop]=r,s.modelTrigger(o)})):-1<["INPUT","TEXTAREA"].indexOf(o.tagName)&&-1<u._toi_input.indexOf(o.type)&&(t=h.getVal(c[n].value,h),o.value=t.val,o.addEventListener("input",function(e){var t=o.value,r=u.getVal(c[n].value,u._traces.model,"__");r.parent[r.prop]=t,s.modelTrigger(o)}))}}(t);o.innerText},h=this,t=0;t<r.length;t++)e(t);for(t=0;t<r.length;t++)for(var a=r[t],n=a.attributes,l=0;l<n.length;l++)if(/^hc:/.test(n[l].name))switch(n[l].name){case"hc:ref":this._refs[n[l].value]=a;break;case"hc:click":this.registEventListener(a,"click",n[l])}}this._on&&this._on.mounted&&this._on.mounted()},Hacci.prototype.refresh=function(){this.clearData(),this.clearEventListeners(),this.init()},Hacci.prototype.clearData=function(){for(var e=new RegExp(/^__hc\.(v_.+|lstn$|refs$)/),t=Object.keys(this),r=0;r<t.length;r++)e.test(t[r])&&delete this[t[r]]},Hacci.prototype.clearEventListeners=function(){for(var e=0;e<this._event_listeners.length;e++){var t=this._event_listeners[e];t.el.removeEventListener(t.name,t.listener)}this._event_listeners=[]},Hacci.prototype.modelTrigger=function(e){for(var t=null,r=e.attributes,a=0;a<r.length;a++)if(/^hc:model$/.test(r[a].name)){t=r[a];break}if(t)for(var n=this.getVal(t.value,this),l=[],i=this.el.querySelectorAll("*"),a=0;a<i.length;a++){for(var o=i[a],r=o.attributes,c={change:{proc:!1,attr:null},input:{proc:!1,attr:null}},s=0;s<r.length;s++)if(/^hc:change$/.test(r[s].name)){c.change.proc=!0,c.change.attr=r[s].value;break}for(var u=0;u<r.length;u++)if(/^hc:input$/.test(r[u].name)){c.input.proc=!0,c.input.attr=r[u].value;break}for(var h=0;h<r.length;h++)if(/^hc:model$/.test(r[h].name)&&r[h].value===t.value)if("INPUT"===o.tagName&&-1<this._toi_check.indexOf(o.type)){Array.isArray(n.val)?o.checked=-1<n.val.indexOf(o.value):o.checked=n.val==o.value;var p=o.hasAttribute("name")?o.getAttribute("name"):null,v=-1<l.indexOf(p);v&&(c.change.proc=!1),v||l.push(p),c.change.proc&&this.callMethod({attr:{value:c.change.attr},evt:null})}else if("SELECT"===o.tagName&&-1<this._toi_select.indexOf(o.type)){for(var d=o.querySelectorAll("option"),f=0;f<d.length;f++)Array.isArray(n.val)?d[f].selected=-1<n.val.indexOf(d[f].value):d[f].selected=n.val==d[f].value;c.change.proc&&this.callMethod({attr:{value:c.change.attr},evt:null})}else-1<["INPUT","TEXTAREA"].indexOf(o.tagName)&&-1<this._toi_input.indexOf(o.type)&&(o.value=n.val,c.input.proc&&this.callMethod({attr:{value:c.input.attr},evt:null}));else/^hc:html$/.test(r[h].name)&&r[h].value===t.value?o.innerHTML=n.val:/^hc:text$/.test(r[h].name)&&r[h].value===t.value&&(o.innerText=n.val)}},Hacci.prototype.registEventListener=function(e,t,r){function a(e){n.callMethod({attr:r,evt:e})}var n=this;e.addEventListener(t,a),this._event_listeners.push({el:e,name:t,listener:a})},Hacci.prototype.callMethod=function(option){var has_bracket=-1<option.attr.value.indexOf("("),method_name=has_bracket?option.attr.value.replace(/\(.*/,""):option.attr.value,args_1;has_bracket?(args_1=option.attr.value.replace(/^\w*\(/,"").replace(/\)$/,"").split(/,(?=(?:(?:[^']*'){2})*[^']*$)/),args_1.forEach(function(el,idx){var new_el=el.replace(/^\s*/,"").replace(/\s*$/,"");args_1[idx]="_event"===new_el?option.evt:eval(new_el)}),this[method_name].apply(this,args_1)):this[method_name](option.evt)},Hacci.prototype.getRandomString=function(e){for(var t="",r=0;r<e;r++){var a=Math.floor(51*Math.random());t+=String.fromCharCode(a+(a<26?65:71))}return t},Hacci.prototype.createInstanceId=function(){return this.getRandomString(8)+"_"+Date.now()},Hacci.prototype.createTagId=function(){return this.getRandomString(6)+"_"+Date.now()},Hacci.prototype.getCommentElement=function(e,t){for(var r=null,a=0;a<e.childNodes.length;a++){var n=e.childNodes[a];if(n.nodeType===Node.COMMENT_NODE&&n.textContent=="//hc:"+this._id+":"+t){r=n;break}}return r},Hacci.prototype.isArrowFunc=function(e){return void 0===e.prototype},Hacci.prototype.fromArrowFunc=function(e){if(this.isArrowFunc(e)){var t="return function"+("("===(t=e.toString()).substring(0,1)?"":"(")+t.replace(/\)?\s*=>.*{(.|\r|\n)*/,")")+t.replace(/^.*=>\s*{/,"{");return new Function(t)()}return e},Hacci.prototype.getCheckedValue=function(e,t){for(var r=(t=void 0===t?!1:t)?[]:null,a=0;a<e.length;a++){var n=e[a];if(n.checked&&!t){r=n.value;break}n.checked&&t&&r.push(n.value)}return r},Hacci.prototype.getSelectedValue=function(e,t){for(var r=(t=void 0===t?!1:t)?[]:null,a=0;a<e.length;a++){var n=e[a];if(n.selected&&!t){r=n.value;break}n.selected&&t&&r.push(n.value)}return r},Hacci.prototype.setCheckedValue=function(e,t){for(var r=!1,a=!1,n=0;n<e.length;n++){var l=e[n];if(!a&&l.checked&&(a=!0),r=!r&&(l.checked&&(Array.isArray(t)?t.indexOf(l.value)<0:t!=l.value)||!l.checked&&(Array.isArray(t)?-1<t.indexOf(l.value):t==l.value))?!0:r)break}a||r||(r=!0);for(n=0;n<e.length;n++)(l=e[n]).checked=Array.isArray(t)?-1<t.indexOf(l.value):t==l.value;return r},Hacci.prototype.setSelectedValue=function(e,t){for(var r=!1,a=!1,n=0;n<e.length;n++){var l=e[n];if(!a&&l.selected&&(a=!0),r=!r&&(l.selected&&(Array.isArray(t)?t.indexOf(l.value)<0:t!=l.value)||!l.selected&&(Array.isArray(t)?-1<t.indexOf(l.value):t==l.value))?!0:r)break}a||r||(r=!0);for(n=0;n<e.length;n++)(l=e[n]).selected=Array.isArray(t)?-1<t.indexOf(l.value):t==l.value;return r},Hacci.prototype.getVal=function(val,init_parent,prefix){if(void 0===prefix&&(prefix=""),new RegExp(/^(true|false|'.+'|\d+)$/).test(val))return{parent:null,prop:null,val:eval(val)};for(var rtn_val={parent:null,prop:null,val:init_parent},strs=val.split("."),cnti=0;cnti<strs.length;cnti++)0!==cnti?(rtn_val.parent=rtn_val.val,rtn_val.prop=prefix+strs[cnti],rtn_val.val=rtn_val.val[prefix+strs[cnti]]):(rtn_val.parent=rtn_val.val,rtn_val.prop=prefix+strs[0],rtn_val.val=rtn_val.val[prefix+strs[0]]);return rtn_val},Hacci.prototype.setVal=function(e,t,r){for(var a=r,n=e.split("."),l=0;l<n.length;l++)void 0===a["__"+n[l]]&&(a["__"+n[l]]={}),l>=n.length-1?a["__"+n[l]]=t:a=a["__"+n[l]]},Hacci.prototype.traceModel=function(f){var _,t,r,a;new RegExp(/^(true|false|'.+'|\d+)$/).test(f.property)||(_=this,-1<["undefined","null"].indexOf(typeof f.parent)&&(f.parent=this),this._traces.model.__listen||(this._traces.model.__listen=function(e,t){if(_._objs[e]&&Array.isArray(_._objs[e]))for(var r=0;r<_._objs[e].length;r++){var a=_._objs[e][r];if("if"===a.type){var n=_.getCommentElement(a.parent,a.tag_id);if(n&&(n.parentNode.insertBefore(a.element,n),n.parentNode.removeChild(n),_._objs[e].splice(r,1),r--,_._objs[e].length<1)){delete _._objs[e];break}}}for(var l=[],i=_.el.querySelectorAll("*"),r=0;r<i.length;r++){for(var o=i[r],c=o.attributes,s={change:{proc:!1,attr:null},input:{proc:!1,attr:null}},u=0;u<c.length;u++)if(/^hc:change$/.test(c[u].name)){s.change.proc=!0,s.change.attr=c[u].value;break}for(u=0;u<c.length;u++)if(/^hc:input$/.test(c[u].name)){s.input.proc=!0,s.input.attr=c[u].value;break}for(var h,p,v,d,u=0;u<c.length;u++)/^hc:(if|neither)$/.test(c[u].name)&&c[u].value===e?(/^hc:if$/.test(c[u].name)&&!1===t||/^hc:neither$/.test(c[u].name)&&!0===t)&&(p=_.createTagId(),h=window.document.createComment("//hc:"+_._id+":"+p),o.parentNode.insertBefore(h,o),_._objs[e]||(_._objs[e]=[]),_._objs[e].push({type:"if",tag_id:p,parent:o.parentElement,element:o}),o.parentNode.removeChild(o)):/^hc:html$/.test(c[u].name)&&c[u].value===e?o.innerHTML=f.parent[f.property]:/^hc:text$/.test(c[u].name)&&c[u].value===e?o.innerText=f.parent[f.property]:/^hc:model$/.test(c[u].name)&&c[u].value===e&&("INPUT"===o.tagName&&-1<_._toi_check.indexOf(o.type)?((h=o.hasAttribute("name")?o.getAttribute("name"):null)?(v=_.el.querySelectorAll("*[name="+h+"]"),d=_.setCheckedValue(v,t),s.change.proc=s.change.proc&&d,(p=-1<l.indexOf(h))&&(s.change.proc=!1),p||l.push(h)):o.checked=o.value==t,s.change.proc&&_.callMethod({attr:{value:s.change.attr},evt:null})):"SELECT"===o.tagName&&-1<_._toi_select.indexOf(o.type)?(v=o.querySelectorAll("option"),d=_.setSelectedValue(v,t),s.change.proc=s.change.proc&&d,s.change.proc&&_.callMethod({attr:{value:s.change.attr},evt:null})):-1<["INPUT","TEXTAREA"].indexOf(o.tagName)&&-1<_._toi_input.indexOf(o.type)&&(d=o.value!=t,s.input.proc=s.input.proc&&d,o.value=t,s.input.proc&&_.callMethod({attr:{value:s.input.attr},evt:null})))}}),t=this._traces.model,r=this.getVal(f.property,this),this.setVal(f.property,r.val,t),a=this.getVal(f.property,t,"__"),Array.isArray(r.parent[r.prop])&&this.arrayEventListener(f.property,r.parent[r.prop]),r.parent&&r.prop&&Object.defineProperty(r.parent,r.prop,{get:function(){return _.getVal(f.property,t,"__").val},set:function(e){a.parent["__"+r.prop]=e,Array.isArray(e)&&_.arrayEventListener(f.property,e),t.__listen(f.property,e)}}))},Hacci.prototype.destroy=function(){this.clearEventListeners(),this._refs={},this._template&&this.el.parentElement.removeChild(this.el),this._template=null,this._el=null,this._on&&this._on.destroyed&&this._on.destroyed(),this._on={created:null,mounted:null,destroyed:null},Hacci.instances[this._id]&&(Hacci.instances[this._id]=null,delete Hacci.instances[this._id])},Hacci.prototype.mount=function(e){return e&&(this._el=e),this.init(),this},Object.defineProperty(Hacci.prototype,"el",{get:function(){return this._el},enumerable:!0,configurable:!0}),Object.defineProperty(Hacci.prototype,"refs",{get:function(){return this._refs},enumerable:!0,configurable:!0}),Hacci._instances={},Hacci}();window.Hacci=Hacci;
