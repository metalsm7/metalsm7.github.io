"use strict";var Hacci=function(){function o(e){if(void 0===e&&(e=null),this._id=null,this._el=null,this._refs={},this._traces={model:{value:{},listen:null},elements:[],txts:[]},this._txts_mstr=null,this._event_listeners=[],this._on={created:null,mounted:null,destroyed:null},this._toi_input=["email","hidden","number","password","search","tel","url","datetime","text","textarea"],this._toi_check=["radio","checkbox"],this._toi_select=["select-one","select-multiple"],this._bus={},(e=e||{id:null,el:null,template:null,data:null,computed:null,method:null,created:null,mounted:null,destroyed:null}).id||(e.id=this.createInstanceId()),!new RegExp(/^[a-zA-Z_][0-9a-zA-Z_-]+$/).test(e.id))throw new Error("id format is invalid");if(this._id=e.id,o.instances[this._id]=this,e.el&&(this._el=e.el),e.template&&(this._template=e.template),e.data)for(var t=Object.keys(e.data),n=0;n<t.length;n++)this[t[n]]=e.data[t[n]],this.redefineModel(t[n]);if(e.computed)for(var r=Object.keys(e.computed),n=0;n<r.length;n++)this[r[n]]=this.fromArrowFunc(e.computed[r[n]]).bind(this);if(e.method)for(var i=Object.keys(e.method),n=0;n<i.length;n++)this[i[n]]=this.fromArrowFunc(e.method[i[n]]).bind(this);e.created&&(this._on.created=this.fromArrowFunc(e.created).bind(this)),e.mounted&&(this._on.mounted=this.fromArrowFunc(e.mounted).bind(this)),e.destroyed&&(this._on.destroyed=this.fromArrowFunc(e.destroyed).bind(this)),this._template&&(this.el.innerHTML=this._template),this._on&&this._on.created&&this._on.created()}return Object.defineProperty(o,"instances",{get:function(){return o._instances},enumerable:!0,configurable:!0}),o.prototype.init=function(){var o=this,l=this;if(!l._txts_mstr){l._txts_mstr="";for(var e=Object.keys(l),t=0;t<e.length;t++)1<e[t].length&&"_"===e[t].charAt(0)||(l._txts_mstr+="var "+e[t]+"=this."+e[t]+";\n")}function s(e,t){return new Function("this."+e+"=arguments[0];(Array.isArray(this."+e+") && this.arrayEventListener(this."+e+"));").apply(l,[t])}new MutationObserver(function(e,t){for(var n=0,r=e;n<r.length;n++){var i=r[n];"childList"!==i.type||(i=i.removedNodes)&&0<i.length&&i[0]===o.el&&(t.disconnect(),o.clearEventListeners(),o.destroy())}}).observe(this.el.parentElement,{attributes:!1,childList:!0,subtree:!1}),this.searchTextNodes();for(var r=this.el.querySelectorAll("*"),n=function(e){for(var i,o=r.item(e),a=o.attributes,t=function(e){var r=a.item(e);if(/^hc:.+$/.test(r.name)){var t,n=r.name.substring(3);if("ref"==n)return(l._refs[r.value]=o).hasAttribute(r.name)&&(o.removeAttribute(r.name),--e),i=e,"continue";switch(l._traces.elements.indexOf(o)<0&&l._traces.elements.push(o),o._hc||(o._hc={attr:{},comment:null}),"neither"===n?o._hc.attr.if="!("+r.value+")":o._hc.attr[n]=r.value,"model"===n&&(t=function(e){e=new Function(l._txts_mstr+"return "+e+";").apply(l);return e="function"==typeof e?e():e}(r.value),Array.isArray(t)&&l.arrayEventListener(t),"INPUT"===o.tagName&&-1<["radio","checkbox"].indexOf(o.type)&&o.addEventListener("change",function(e){var t=null;"radio"===o.type&&(t=o.checked?o.value:null),"checkbox"===o.type&&(t=o.checked?o.value:o.hasAttribute("name")?[]:null);var n=o.hasAttribute("name")?o.getAttribute("name"):null;t=n?(n=l.el.querySelectorAll("*[name="+n+"]"),l.getCheckedValue(n,"checkbox"===o.type)):o.checked?o.value:null,o["_hc:force_apply"]=!0,s(r.value,t)}),"SELECT"===o.tagName&&-1<["select-one","select-multiple"].indexOf(o.type)&&o.addEventListener("change",function(e){o.type;var t=o.querySelectorAll("option"),n=l.getSelectedValue(t,"select-multiple"===o.type);o["_hc:force_apply"]=!0,s(r.value,n)}),-1<["INPUT","TEXTAREA"].indexOf(o.tagName)&&-1<["email","hidden","number","password","search","tel","url","datetime","text","textarea"].indexOf(o.type)&&o.addEventListener("input",function(e){o["_hc:force_apply"]=!0,s(r.value,o.value)})),n){case"scroll.hit.top":case"scroll.hit.bottom":l.registEventListener(o,"scroll",r,function(e){(-1<r.name.indexOf("bottom")?l.scrollTop(o)+l.innerHeight(o)>=l.scrollHeight(o):l.scrollTop(o)<=0)&&function(e){var t=e;e.indexOf("(")<0&&(t+="()");t=t.replace(/;$/,"");new Function(l._txts_mstr+"return "+t+";").apply(l)}(r.value)});break;default:void 0!==window["on"+n]&&l.registEventListener(o,n,r)}o.hasAttribute(r.name)&&(o.removeAttribute(r.name),--e)}i=e},n=0;n<a.length;n++)t(n),n=i},t=0;t<r.length;t++)n(t);this.applyModel(),this._on&&this._on.mounted&&this._on.mounted()},o.prototype.redefineModel=function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=null);var r=this;r._traces.model.listen||(r._traces.model.listen=function(){r.applyModel()}),t=t||r;var i=r._traces.model.value,o=n?n+".__"+e:"__"+e;void 0===i[o]&&(i[o]=t[e]);var a=t[e];if(Object.defineProperty(t,e,{get:function(){return i[o]},set:function(e){i[o]=e,Array.isArray(i[o])&&r.arrayEventListener(i[o]),r._traces.model.listen(o,i[o]),r.applyTextChange()}}),a instanceof Object&&-1<["object"].indexOf(typeof a))for(var l=Object.keys(a),s=0;s<l.length;s++){var c=l[s];this.redefineModel(c,a,o)}},o.prototype.applyModel=function(){for(var n=this,e=function(e){e=new Function(n._txts_mstr+"return "+e+";").apply(n);return e="function"==typeof e?e():e},t=function(e){var t=e;e.indexOf("(")<0&&(t+="()");t=t.replace(/;$/,"");return new Function(n._txts_mstr+"return "+t+";").apply(n)},r=[],i=0;i<n._traces.elements.length;i++){var o,a,l,s,c,u,h=n._traces.elements[i],d=h._hc;d.attr.if&&(!0===(o=e(d.attr.if))&&d.comment?(d.comment.parentNode.insertBefore(h,d.comment),d.comment.parentNode.removeChild(d.comment),delete d.comment,d.comment=null):!1!==o||d.comment||(d.comment=window.document.createComment("//hc:"+n._id+":"+n.createTagId()),h.parentNode.insertBefore(d.comment,h),h.parentNode.removeChild(h))),d.attr.disabled&&(o=e(d.attr.disabled),h.disabled=o),d.attr.html&&(o=e(d.attr.html),h.innerHTML=o),d.attr.text&&(o=e(d.attr.text),h.innerText=o),d.attr.value&&(o=e(d.attr.value),h.value=o),d.attr.model&&(o=e(d.attr.model),"INPUT"===h.tagName&&-1<n._toi_check.indexOf(h.type)?(l=!1,(a=h.hasAttribute("name")?h.getAttribute("name"):null)?r.indexOf(a)<0&&(r.push(a),s=n.el.querySelectorAll("*[name="+a+"]"),u=n.setCheckedValue(s,o),l=d.attr.change&&u):(c=h.checked,h.checked=h.value==o,l=h.checked!=c),!l&&h["_hc:force_apply"]&&(l=!0,delete h["_hc:force_apply"]),l&&d.attr.change&&t(d.attr.change)):"SELECT"===h.tagName&&-1<n._toi_select.indexOf(h.type)?(l=!1,s=h.querySelectorAll("option"),u=n.setSelectedValue(s,o),!(l=d.attr.change&&u)&&h["_hc:force_apply"]&&(l=!0,delete h["_hc:force_apply"]),l&&d.attr.change&&t(d.attr.change)):-1<["INPUT","TEXTAREA"].indexOf(h.tagName)&&-1<n._toi_input.indexOf(h.type)&&(c=!1,u=h.value!=o,h.value=o,!(c=d.attr.input&&u)&&h["_hc:force_apply"]&&(c=!0,delete h["_hc:force_apply"]),c&&d.attr.input&&t(d.attr.input)))}},o.prototype.arrayEventListener=function(r){var i=this;r.push=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=(n=Array.prototype.push).call.apply(n,[r].concat(e));return i._traces.model.listen(),n},r.pop=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=(n=Array.prototype.pop).call.apply(n,[r].concat(e));return i._traces.model.listen(),n},r.splice=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=(n=Array.prototype.splice).call.apply(n,[r].concat(e));return i._traces.model.listen(),n},r.shift=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=(n=Array.prototype.shift).call.apply(n,[r].concat(e));return i._traces.model.listen(),n},r.unshift=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=(n=Array.prototype.unshift).call.apply(n,[r].concat(e));return i._traces.model.listen(),n}},o.prototype.registEventListener=function(e,t,n,r){var i=this;e.addEventListener(t,r=(r=void 0===r?null:r)||function(e){!function(e,t){var n=t;t.indexOf("(")<0&&(n+="(_event)");n=n.replace(/;$/,"");new Function(i._txts_mstr+"try{ var _event=arguments[0]; } catch(e) { _event=arguments[0]; }\nreturn "+n+";").apply(i,[e])}(e,n.value)}),this._event_listeners.push({el:e,name:t,listener:r})},o.prototype.clearEventListeners=function(){for(var e=0;e<this._event_listeners.length;e++){var t=this._event_listeners[e];t.el.removeEventListener(t.name,t.listener)}this._event_listeners=[]},o.prototype.searchTextNodes=function(e){if((e=(e=void 0===e?null:e)||this.el).hasChildNodes()){for(var t=0;t<e.childNodes.length;t++)switch(e.childNodes[t].nodeType){case 1:this.searchTextNodes(e.childNodes[t]);break;case 3:/{{([^}}\r\n]+)?}}/g.test(e.childNodes[t].textContent)&&this._traces.txts.push({node:e.childNodes[t],text:e.childNodes[t].textContent,fn:null})}this.applyTextChange()}},o.prototype.applyTextChange=function(){for(var e=this._traces.txts,t=0;t<e.length;t++)e[t].fn||(e[t].fn=this.compileText(e[t].text)),e[t].node.textContent=e[t].fn.apply(this)},o.prototype.compileText=function(e){if(!this._txts_mstr){this._txts_mstr="";for(var t=Object.keys(this),n=0;n<t.length;n++)1<t[n].length&&"_"===t[n].charAt(0)||(this._txts_mstr+="var "+t[n]+"=this."+t[n]+";\n")}for(var r,i=/{{([^}}]+)?}}/g,o=/(^( )?(if|for|else|switch|case|break|{|}))(.*)?/g,a=this._txts_mstr+"var r=[];\n",l=0,s=function(e,t){return a+=(t=void 0===t?null:t)?e.match(o)?e+"\n":"r.push("+e+");\n":""!=e?'r.push("'+e.replace(/"/g,'\\"')+'");\n':"",s};r=i.exec(e);)s(e.slice(l,r.index))(r[1],!0),l=r.index+r[0].length;return s(e.substr(l,e.length-l)),a+='return r.join("");',new Function(a.replace(/[\r\t\n]/g,""))},o.prototype.scrollHeight=function(e){return 9===e.nodeType?Number(window.document.documentElement.scrollHeight):Number(e.scrollHeight)},o.prototype.scrollTop=function(e){e=9===e.nodeType?window.pageYOffset:e.scrollTop;return Math.ceil(e)},o.prototype.innerHeight=function(e){e=9===e.nodeType?Number(Math.max(e.body.scrollHeight,e.documentElement.scrollHeight,e.body.offsetHeight,e.documentElement.offsetHeight,e.documentElement.clientHeight)):Number(e.clientHeight);return Math.ceil(e)},o.prototype.refresh=function(){this.clearData(),this.init()},o.prototype.clearData=function(){for(var e=new RegExp(/^__hc\.(v_.+|lstn$|refs$)/),t=Object.keys(this),n=0;n<t.length;n++)e.test(t[n])&&delete this[t[n]]},o.prototype.getRandomString=function(e){for(var t="",n=0;n<e;n++){var r=Math.floor(51*Math.random());t+=String.fromCharCode(r+(r<26?65:71))}return t},o.prototype.createInstanceId=function(){return this.getRandomString(8)+"_"+Date.now()},o.prototype.createTagId=function(){return this.getRandomString(6)+"_"+Date.now()},o.prototype.isArrowFunc=function(e){return void 0===e.prototype},o.prototype.fromArrowFunc=function(e){if(this.isArrowFunc(e)){var t="return function"+("("===(t=e.toString()).substring(0,1)?"":"(")+t.replace(/\)?\s*=>.*{(.|\r|\n)*/,")")+t.replace(/^.*=>\s*{/,"{");return new Function(t)()}return e},o.prototype.getCheckedValue=function(e,t){for(var n=(t=void 0===t?!1:t)?[]:null,r=0;r<e.length;r++){var i=e[r];if(i.checked&&!t){n=i.value;break}i.checked&&t&&n.push(i.value)}return n},o.prototype.getSelectedValue=function(e,t){for(var n=(t=void 0===t?!1:t)?[]:null,r=0;r<e.length;r++){var i=e[r];if(i.selected&&!t){n=i.value;break}i.selected&&t&&n.push(i.value)}return n},o.prototype.setCheckedValue=function(e,t){for(var n=!1,r=!1,i=0;i<e.length;i++){var o=e[i];if(!r&&o.checked&&(r=!0),n=!n&&(o.checked&&(Array.isArray(t)?t.indexOf(o.value)<0:t!=o.value)||!o.checked&&(Array.isArray(t)?-1<t.indexOf(o.value):t==o.value))?!0:n)break}for(i=0;i<e.length;i++)(o=e[i]).checked=Array.isArray(t)?-1<t.indexOf(o.value):t==o.value;return n},o.prototype.setSelectedValue=function(e,t){for(var n=!1,r=!1,i=0;i<e.length;i++){var o=e[i];if(!r&&o.selected&&(r=!0),n=!n&&(o.selected&&(Array.isArray(t)?t.indexOf(o.value)<0:t!=o.value)||!o.selected&&(Array.isArray(t)?-1<t.indexOf(o.value):t==o.value))?!0:n)break}for(i=0;i<e.length;i++)(o=e[i]).selected=Array.isArray(t)?-1<t.indexOf(o.value):t==o.value;return n},o.prototype.on=function(e,t){this._bus[e]||(this._bus[e]=[]),-1<this._bus[e].indexOf(t)||this._bus[e].push(t)},o.prototype.off=function(e,t){void 0===t&&(t=null),this._bus[e]&&!t?delete this._bus[e]:this._bus[e]&&t&&(-1<(t=this._bus[e].indexOf(t))&&this._bus[e].splice(t,1))},o.prototype.emit=function(e){for(var t,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];if(!this._bus[e])return 0;for(var i=0,o=0;o<this._bus[e].length;o++)try{(t=this._bus[e])[o].apply(t,n),i++}catch(e){}return i},o.prototype.destroy=function(){this.clearEventListeners(),this._refs={},this._template&&this.el.parentElement.removeChild(this.el),this._template=null,this._el=null,this._on&&this._on.destroyed&&this._on.destroyed(),this._on={created:null,mounted:null,destroyed:null},o.instances[this._id]&&(o.instances[this._id]=null,delete o.instances[this._id])},o.prototype.mount=function(e){return e&&(this._el=e),this.init(),this},Object.defineProperty(o.prototype,"el",{get:function(){return this._el},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"refs",{get:function(){return this._refs},enumerable:!0,configurable:!0}),o._instances={},o}();window.Hacci=Hacci;
